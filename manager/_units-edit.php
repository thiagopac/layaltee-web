<div class="m-grid__item m-grid__item--fluid m-wrapper">
   <!-- BEGIN: Subheader -->
   <div class="m-subheader ">
      <div class="d-flex align-items-center">
         <div class="mr-auto">
            <h3 class="m-subheader__title m-subheader__title--separator">
               Unidades
            </h3>
            <ul class="m-subheader__breadcrumbs m-nav m-nav--inline">
               <li class="m-nav__item m-nav__item--home">
                  <a href="#" class="m-nav__link m-nav__link--icon">
                  <i class="m-nav__link-icon la la-home"></i>
                  </a>
               </li>
               <li class="m-nav__separator">
                  -
               </li>
               <li class="m-nav__item">
                  <a href="" class="m-nav__link">
                  <span class="m-nav__link-text">
                  Unidades
                  </span>
                  </a>
               </li>
               <li class="m-nav__separator">
                  -
               </li>
               <li class="m-nav__item">
                  <a href="" class="m-nav__link">
                  <span class="m-nav__link-text">
                  Editar unidade
                  </span>
                  </a>
               </li>
            </ul>
         </div>
      </div>
   </div>
   <!-- END: Subheader -->
   <!-- BEGIN: content -->
   <div class="m-content">
      <div class="m-portlet">
         <!--begin::Form-->
         <form class="m-form m-form--label-align-right" id="formUnitNew">
            <div class="m-portlet__body">
               <div class="m-form__section m-form__section--first">
                  <input type="hidden" class="form-control m-input" placeholder="Nome do local" id="localIdUnitNew">
                   <input type="hidden" class="form-control m-input" placeholder="Nome do local" id="unitIdUnitNew">
                  <div class="form-group m-form__group row">
                     <label class="col-lg-3 col-form-label">
                     Rua/Avenida:
                     </label>
                     <div class="col-lg-6">
                        <input type="text" class="form-control m-input" placeholder="Rua/Avenida" id="localStreetUnitNew">
                        <span class="m-form__help">
                        Ex: Rua da Bahia / Av. Afonso Pena
                        </span>
                     </div>
                  </div>
                  <div class="form-group m-form__group row">
                     <label class="col-lg-3 col-form-label">
                     Número (Endereço):
                     </label>
                     <div class="col-lg-6">
                        <input type="text" class="form-control m-input" placeholder="Número" id="localNumberUnitNew">
                        <span class="m-form__help">
                        Ex: 1200
                        </span>
                     </div>
                  </div>
                  <div class="form-group m-form__group row">
                     <label class="col-lg-3 col-form-label">
                     Bairro:
                     </label>
                     <div class="col-lg-6">
                        <input type="text" class="form-control m-input" placeholder="Bairro" id="localNeiborhoodUnitNew">
                        <span class="m-form__help">
                        Ex: Santa Tereza
                        </span>
                     </div>
                  </div>
                  <div class="form-group m-form__group row">
                     <label class="col-lg-3 col-form-label">
                     Cidade:
                     </label>
                     <div class="col-lg-6">
                        <input type="text" class="form-control m-input" placeholder="Cidade" id="localCityUnitNew">
                        <span class="m-form__help">
                        Ex: Belo Horizonte
                        </span>
                     </div>
                  </div>
                  <div class="form-group m-form__group row">
                     <label class="col-lg-3 col-form-label">
                     Estado:
                     </label>
                     <div class="col-lg-6">
                        <input type="text" class="form-control m-input" placeholder="Estado" id="localStateUnitNew">
                        <span class="m-form__help">
                        Ex: MG
                        </span>
                     </div>
                  </div>
                  <div class="form-group m-form__group row">
                     <label class="col-lg-3 col-form-label">
                     CEP:
                     </label>
                     <div class="col-lg-6">
                        <input type="text" class="form-control m-input" placeholder="CEP" id="localZipcodeUnitNew">
                        <span class="m-form__help">
                        Ex: 31300-200
                        </span>
                     </div>
                  </div>
                  <div class="form-group m-form__group row">
                     <label class="col-lg-3 col-form-label">
                     Latitude:
                     </label>
                     <div class="col-lg-6">
                        <input type="text" class="form-control m-input" placeholder="Latitude" id="localLatitudeUnitNew">
                        <span class="m-form__help">
                        Ex: -19.000000
                        </span>
                     </div>
                  </div>
                  <div class="form-group m-form__group row">
                     <label class="col-lg-3 col-form-label">
                     Longitude:
                     </label>
                     <div class="col-lg-6">
                        <input type="text" class="form-control m-input" placeholder="Longitude" id="localLongitudeUnitNew">
                        <span class="m-form__help">
                        Ex: -43.000000
                        </span>
                     </div>
                  </div>
                  <div class="form-group m-form__group row">
                     <label class="col-lg-3 col-form-label">
                     Horário de funcionamento:
                     </label>
                     <div class="col-lg-6">
                        <input type="text" class="form-control m-input" placeholder="Horário de funcionamento" id="localOperatingHoursUnitNew">
                        <span class="m-form__help">
                        Ex: Terça-feira à Quinta-feira das 18h às 23h, Sexta-feira, Sábado e Domingo das 18h às 00h
                        </span>
                     </div>
                  </div>
                  <div class="form-group m-form__group row">
                     <label class="col-lg-3 col-form-label">
                     Contatos:
                     </label>
                     <div class="col-lg-6">
                        <input type="text" class="form-control m-input" placeholder="Contatos" id="localContactsUnitNew">
                        <span class="m-form__help">
                        Ex: (31)3333-3333 | (31)98888-8888
                        </span>
                     </div>
                  </div>
               </div>
            </div>
            <div class="m-portlet__foot m-portlet__foot--fit">
               <div class="m-form__actions m-form__actions">
                  <div class="row">
                     <div class="col-lg-3"></div>
                     <div class="col-lg-6">
                        <button class="btn btn-primary" id="btnSaveUnitNew">
                        Salvar
                        </button>
                        <button class="btn btn-secondary" onclick="window.history.go(-1); return false;">
                        Cancelar
                        </button>
                     </div>
                  </div>
               </div>
            </div>
         </form>
         <!--end::Form-->
      </div>
   </div>
   <!-- END: content -->
</div>
<script>
   jQuery(document).ready(function() {

     $("#btnSave").click(function () {
       //apagar dados da sessão do admin e enviar para página de login

     });

       if(sessionStorage.getItem("BASE_URL")){
           var BASE_URL = sessionStorage.getItem("BASE_URL");
       }

       let searchParams = new URLSearchParams(window.location.search);

       if (searchParams.has('unit-id')){
           let valUnitId = searchParams.get('unit-id');

           $.ajax({
               url: BASE_URL+'manager/webapi/unit/info/'+valUnitId,
               type: 'GET',
               contentType: 'application/json',
               dataType:"json",
               async: true,
               success: function (result) {
                   var response = result;

                   if(response["status"] == 1){

                    unit = response["info"];

                     $('#localIdUnitNew').val(unit.localId);
                     $('#unitIdUnitNew').val(unit.unitId);
                     $('#localNameUnitNew').val(unit.localName);
                     $('#localStreetUnitNew').val(unit.localStreet);
                     $('#localNumberUnitNew').val(unit.localNumber);
                     $('#localNeiborhoodUnitNew').val(unit.localNeiborhood);
                     $('#localCityUnitNew').val(unit.localCity)
                     $('#localStateUnitNew').val(unit.localState)
                     $('#localZipcodeUnitNew').val(unit.localZipcode)
                     $('#localLatitudeUnitNew').val(unit.localLatitude);
                     $('#localLongitudeUnitNew').val(unit.localLongitude);
                     $('#localOperatingHoursUnitNew').val(unit.localOperatingHours);
                     $('#localContactsUnitNew').val(unit.localContacts);

                   }else if(response["status"] == 2){
                       toastr.error(response["statusMessage"]);
                   }
               }, error: function (result) {
                   toastr.error("Erro no servidor. Tente novamente mais tarde.");
               }
           });
       }


     var FormValidation = function () {

   		var handleValidation = function() {

   						var form1 = $('#formUnitNew');

   						form1.validate({
   								errorElement: 'span', //default input error message container
   								errorClass: 'help-block help-block-error', // default input error message class
   								focusInvalid: true, // do not focus the last invalid input
   								ignore: "",  // validate all fields including form hidden input
   								rules: {
   										localNameUnitNew: {
   												required: true
   										},
   										localStreetUnitNew: {
   												required: false
   										},
   										localNumberUnitNew: {
   												required: true
   										},
                       localNeiborhoodUnitNew: {
   												required: true
   										},
                       localCityUnitNew: {
   												required: true
   										},
                       localStateUnitNew: {
   												required: true
   										},
                       localZipcodeUnitNew: {
   												required: true
   										},
                       localLatitudeUnitNew: {
   												required: true
   										},
                       localLongitudeUnitNew: {
   												required: true
   										},
                       localOperatingHoursUnitNew: {
   												required: true
   										},
                       localContactsUnitNew: {
   												required: true
   										},
                       localCouponsOfferingUnitNew: {
   												required: true
   										},
                       localCouponsPrizeUnitNew: {
   												required: true
   										}
   								},

   								invalidHandler: function (event, validator) { //display error alert on form submit
   										toastr.error("Certifique-se de obedecer a regra de preenchimento de cada campo");
   								},

   								highlight: function (element) { // hightlight error inputs
   										$(element)
   												.closest('.form-group').addClass('has-error'); // set error class to the control group
   								},

   								unhighlight: function (element) { // revert the change done by hightlight
   										$(element)
   												.closest('.form-group').removeClass('has-error'); // set error class to the control group
   								},

   								success: function (label) {
   										label
   												.closest('.form-group').removeClass('has-error'); // set success class to the control group
   								},

   								submitHandler: function (form) {

                     valLocalId = $("#localIdUnitNew").val();
                     valUnitId = $("#unitIdUnitNew").val();
                     valLocalName = $("#localNameUnitNew").val();
                     valLocalStreet = $("#localStreetUnitNew").val();
                     valLocalNumber = $("#localNumberUnitNew").val();
                     valLocalNeiborhood = $("#localNeiborhoodUnitNew").val();
                     valLocalCity = $("#localCityUnitNew").val();
                     valLocalState = $("#localStateUnitNew").val();
                     valLocalZipcode = $("#localZipcodeUnitNew").val();
                     valLocalLatitude = $("#localLatitudeUnitNew").val();
                     valLocalLongitude = $("#localLongitudeUnitNew").val();
                     valLocalOperatingHours = $("#localOperatingHoursUnitNew").val();
                     valLocalContacts = $("#localContactsUnitNew").val();
                     valLocalCouponsOffering = $("#localCouponsOfferingUnitNew").val();
                     valLocalCouponsPrize = $("#localCouponsPrizeUnitNew").val();

                     if(sessionStorage.getItem("BASE_URL")){
                   			var BASE_URL = sessionStorage.getItem("BASE_URL");
                   	}

   									$.ajax({
   											url: BASE_URL+'manager/webapi/unit/info/update',
   											type: 'POST',
   											contentType: 'application/json',
   											dataType:"json",
   											async: true,
   											data: JSON.stringify({unitId: valUnitId, localId: valLocalId, localStreet : valLocalStreet, localNumber : valLocalNumber, localNeiborhood : valLocalNeiborhood,
                           localCity : valLocalCity, localState : valLocalState, localZipcode : valLocalZipcode, localLatitude : valLocalLatitude, localLongitude : valLocalLongitude,
                           localOperatingHours : valLocalOperatingHours, localContacts : valLocalContacts}),
   											success: function (result) {
   												var response = result;

   												// console.log(response);

   												if(response["status"] == 1){

   													local = response["info"];
                            sessionStorage.removeItem("local");
   													sessionStorage.setItem("local",JSON.stringify(local));

   													// toastr.success("Sucesso! Os dados do local foram salvos.");
                            // swal("Prontinho!", response["statusMessage"], "success");
                            swal({
                                position: "top-right",
                                type: "success",
                                title: response["statusMessage"],
                                showConfirmButton: !1,
                                timer: 1500
                            })

   												}else if(response["status"] == 2){
   													// toastr.error(response["statusMessage"]);
                            // swal("Ops!", response["statusMessage"], "error");
                            swal({
                                position: "top-right",
                                type: "error",
                                title: response["statusMessage"],
                                showConfirmButton: !1,
                                timer: 1500
                            })
   												}
   											}, error: function (result) {
   													toastr.error("Erro no servidor. Tente novamente mais tarde.");
   											}
   									});

   								}
   						});
   					}
   				handleValidation();
   		 }();

   });
</script>
